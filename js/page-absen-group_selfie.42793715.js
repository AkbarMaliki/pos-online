(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["page-absen-group_selfie"],{"0538":function(e,t,a){"use strict";var n=a("1c0b"),i=a("861d"),s=[].slice,r={},o=function(e,t,a){if(!(t in r)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";r[t]=Function("C,a","return new C("+n.join(",")+")")}return r[t](e,a)};e.exports=Function.bind||function(e){var t=n(this),a=s.call(arguments,1),r=function(){var n=a.concat(s.call(arguments));return this instanceof r?o(t,n.length,n):t.apply(e,n)};return i(t.prototype)&&(r.prototype=t.prototype),r}},"07ac":function(e,t,a){var n=a("23e7"),i=a("6f53").values;n({target:"Object",stat:!0},{values:function(e){return i(e)}})},"0d03":function(e,t,a){var n=a("6eeb"),i=Date.prototype,s="Invalid Date",r="toString",o=i[r],c=i.getTime;new Date(NaN)+""!=s&&n(i,r,(function(){var e=c.call(this);return e===e?o.call(this):s}))},"0e43":function(e,t,a){"use strict";a("86b1")},"6f53":function(e,t,a){var n=a("83ab"),i=a("df75"),s=a("fc6a"),r=a("d1e7").f,o=function(e){return function(t){var a,o=s(t),c=i(o),l=c.length,d=0,u=[];while(l>d)a=c[d++],n&&!r.call(o,a)||u.push(e?[a,o[a]]:o[a]);return u}};e.exports={entries:o(!0),values:o(!1)}},"86b1":function(e,t,a){},a49e:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"py-4 px-2 shadow bg-blue-light text-white font-bold"},[a("p",{staticClass:"mt-1 font-semibold text-xs float-right mr-3"},[e._v(" Face Recognition ")]),a("div",{staticClass:"ml-2 cursor-pointer",on:{click:function(t){return e.$router.go(-1)}}},[a("svg",{staticClass:"d-inline mr-1",staticStyle:{fill:"white"},attrs:{width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"}},[a("path",{attrs:{d:"M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"}})])])]),a("div",{staticClass:"row"},[e.streamOn?a("div",{staticClass:"col-sm-12 text-center"},[a("video",{attrs:{id:"videoQRCODE",autoplay:"",muted:""},domProps:{muted:!0}}),a("div",{staticClass:"text-center rounded-t-lg shadow background_gps p-3"},[a("div",{staticStyle:{height:"70px"}},[a("div",{staticClass:"row justify-content-center"},[a("div",{staticClass:"col-9"},[a("div",{staticClass:"text-center"},[a("button",{staticClass:"p-3 mt-2 btn btn-sm btn-warning rounded-lg font-semibold btn-block text-sm",attrs:{type:"submit"},on:{click:e.startScan}},[a("svg",{staticClass:"d-inline mr-2",staticStyle:{fill:"black"},attrs:{width:"17",height:"17",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[a("path",{attrs:{d:"M220.6 121.2L271.1 96 448 96v96H333.2c-21.9-15.1-48.5-24-77.2-24s-55.2 8.9-77.2 24H64V128H192c9.9 0 19.7-2.3 28.6-6.8zM0 128V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H271.1c-9.9 0-19.7 2.3-28.6 6.8L192 64H160V48c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16l0 16C28.7 64 0 92.7 0 128zM168 304a88 88 0 1 1 176 0 88 88 0 1 1 -176 0z"}})]),e._v(" Take Picture ")])])])]),a("p",{staticClass:"text-xs font-semibold text-white"},[e._v(" Remove Mask and any other accessories before take a selfie ! ")])]),a("br"),a("br"),a("br"),a("br"),a("br")]),a("div",{staticClass:"text-xs p-3 font-semibold"},[""!=e.message?a("p",[e._v(e._s(e.message))]):e._e()]),a("canvas",{staticClass:"d-none",staticStyle:{overflow:"auto"},attrs:{id:"canvas"}})]):a("div",{staticClass:"col-sm-12",staticStyle:{height:"100vh"},on:{click:function(t){e.getStream("video"),e.streamOn=!0,e.$forceUpdate()}}},[e._m(0)])])])},i=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"d-flex justify-content-center align-items-center shadow-lg rounded-lg",staticStyle:{height:"90vh"}},[a("div",{staticStyle:{width:"100%"}},[a("p",{staticClass:"text-center text-xl font-semibold"},[e._v(" Klik disini untuk Start Camera! ")])])])}],s=a("1da1"),r=(a("96cf"),a("4160"),a("159b"),a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("d81d"),a("cfc3"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("ace4"),a("07ac"),a("e25e"),a("0d03"),a("4795"),a("2b3d"),a("c0b6"),a("bc3a"),a("2f0b")),o=a("75bf"),c=new r["a"]("ci"),l={data:function(){return{isIos:!1,countIos:0,streamOn:!1,expressions:null,listUsers:[],urutanEkspresi:[],message:"",listExpressions:[]}},methods:{startScan:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,n,i,r,l,d,u,h,g,f,m,v;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.message="",a=document.getElementById("videoQRCODE"),n=t,e.next=6,o["createCanvasFromMedia"](a);case 6:return i=e.sent,i.style.position="absolute;",r={width:i.width,height:i.height},console.log(r),o["euclideanDistance"]([0,0],[0,20]),o["matchDimensions"](i,r),l=null,e.next=15,o["detectAllFaces"](a).withFaceLandmarks().withFaceDescriptors();case 15:return l=e.sent,console.log("change",l[0].landmarks.getMouth()),d=l[0].landmarks.getMouth(),console.log("mulut",d),console.log(l),u=o["resizeResults"](l,r),console.log(i.width,i.height),i.getContext("2d").clearRect(0,0,i.width,i.height),o["draw"].drawDetections(i,u),o["draw"].drawFaceLandmarks(i,u),h=[],n.$store.state.employees.forEach((function(e){h.push({hit_id:e.hit_id,name:e.name,work_location_id:e.work_location_id,facejson:JSON.parse(e.faces)})})),e.next=29,Promise.all(h.map(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.facejson){e.next=4;break}return a=[],t.facejson.forEach((function(e){a.push(new Float32Array(Object.values(e[0])))})),e.abrupt("return",new o["LabeledFaceDescriptors"](JSON.stringify({hit_id:t.hit_id,name:t.name,work_location_id:t.work_location_id,_id:t.hit_id}),a));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 29:if(g=e.sent,f=parseInt(n.$store.state.akurasiWajah)/100,m=new o["FaceMatcher"](g,f),v=l.map((function(e){return m.findBestMatch(e.descriptor)})),!(v.length>0)){e.next=41;break}if("unknown"!=v[0]._label){e.next=37;break}return c.alert("Wajah Tidak ditemukan","bg-black"),e.abrupt("return",!1);case 37:document.querySelectorAll("canvas").forEach((function(e,t){t>0&&e.remove()})),v.forEach(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,a){var s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log(t),s=JSON.parse(t.label),r=JSON.parse(t._distance),console.log(r),n.faceid=s,100-100*r>60?(c.alert("Wajah ditemukan!","bg-green-400"),n.loading=!1,console.log("hasil",s),n.cekExpressionAbsen(s,i)):c.alert("Persentase hanya ".concat(100-100*r),"bg-green-400");case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),e.next=43;break;case 41:n.loading=!1,c.alert("Data tidak ada atau tidak ditemukan di gang ini!");case 43:e.next=49;break;case 45:e.prev=45,e.t0=e["catch"](0),console.log("error"),c.alert("Recognition wajah gagal");case 49:case"end":return e.stop()}}),e,null,[[0,45]])})))()},cekExpressionAbsen:function(e,t){var a=this;if(0==this.listExpressions.length&&(this.listExpressions[0]=this.expressions),0==this.listUsers.length?this.listUsers[0]=e.hit_id:this.listUsers[1]=e.hit_id,this.listUsers.length>0&&this.listExpressions.length>0){if(this.listUsers[0]!=e.hit_id)return this.listUsers[0]=null,void c.alert("Data Perbandingan user tidak sama!");this.listExpressions[0]==this.expressions?this.urutanEkspresi=[]:this.message="Wajah Milik ".concat(e["name"],", \n Gunakan Ekspresi yang berbeda!!"),a.prosesAbsen(e,t)}this.$forceUpdate()},prosesAbsen:function(e,t){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,i,s,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:window.checktimes.remove({},{multi:!0},(function(e,t){})),n=a,c.loadingOn(),i=document.getElementById("videoQRCODE"),s=document.createElement("canvas"),s.width=i.videoWidth,s.height=i.videoHeight,r=s.getContext("2d"),r.drawImage(i,0,0,s.width,s.height),o=s.toDataURL("image/png"),a.$store.state.checktimes.unshift({id_user:e.hit_id,name:e.name,checktime:n.formatTgl(new Date,"YYYY-MM-DD HH:mm:ss"),dataURL:o,work_location:e.work_location_id,lat:n.$store.state.lat,lng:n.$store.state.lng,type_location:n.$store.state.location,source_data:"local"}),window.checktimes.insert(a.$store.state.checktimes,(function(e,t){})),c.alert("Absen Berhasil","bg-blue-400"),c.loadingOff(),a.$router.push("/absen/checktime");case 15:case"end":return t.stop()}}),t)})))()},getImage:function(){var e=this,t=document.getElementById("videoQRCODE"),a=document.getElementById("canvas");a.width=t.videoWidth,a.height=t.videoHeight,a.getContext("2d").drawImage(t,0,0,t.videoWidth,t.videoHeight),a.toBlob((function(t){var a=new File([t],"photo.jpg",{type:"image/jpeg"});e.prosesAbsen(a)}),"image/jpeg")},getStream:function(e){var t=this;setTimeout((function(){var e=document.getElementById("videoQRCODE");console.log("video",e),navigator.mediaDevices.getUserMedia({video:{facingMode:t.$store.state.camera?"user":"environment",resizeMode:"true"}}).then((function(a){t.loading=!1,t.$forceUpdate(),e.srcObject=a,e.src=window.URL.createObjectURL(a),e.play()}))}),2e3)},getUserMedia:function(e){if(navigator.mediaDevices)return navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise((function(a,n){t.bind(navigator)(e,a,n)})):void 0},formatTgl:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD";return this.$datefns.format(new Date(e),t)}},mounted:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e;case 1:case"end":return t.stop()}}),t)})))()}},d=l,u=(a("0e43"),a("2877")),h=Object(u["a"])(d,n,i,!1,null,"7a028e23",null);t["default"]=h.exports},c0b6:function(e,t,a){var n=a("23e7"),i=a("0538");n({target:"Function",proto:!0},{bind:i})},cfc3:function(e,t,a){var n=a("74e8");n("Float32",(function(e){return function(t,a,n){return e(this,t,a,n)}}))},d81d:function(e,t,a){"use strict";var n=a("23e7"),i=a("b727").map,s=a("1dde"),r=s("map");n({target:"Array",proto:!0,forced:!r},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=page-absen-group_selfie.42793715.js.map
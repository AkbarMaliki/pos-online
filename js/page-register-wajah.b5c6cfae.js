(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["page-register-wajah"],{"0212":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"py-4 px-2 shadow bg-blue-light text-white font-bold"},[n("div",{staticClass:"font-semibold text-xs mr-3 float-right mt-2"},[t._v(" Register Face ")]),n("div",{staticClass:"ml-2 cursor-pointer",on:{click:function(e){return t.$router.go(-1)}}},[n("svg",{staticClass:"d-inline mr-1",staticStyle:{fill:"white"},attrs:{width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"}},[n("path",{attrs:{d:"M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"}})])])]),n("div",{staticClass:"row justify-content-center bg-black",staticStyle:{height:"100vh"}},[n("div",{staticClass:"col-8 mt-4 text-center"},[n("img",{staticStyle:{height:"120px",width:"170px",display:"block",margin:"auto"},attrs:{src:"",id:"outputImage",alt:""},on:{click:t.saveFace}}),n("div",{directives:[{name:"show",rawName:"v-show",value:t.simpanOutput,expression:"simpanOutput"}],staticClass:"mt-4"},[n("div",{staticClass:"sm-form"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.vdata["hit_id"],expression:"vdata['hit_id']"}],staticClass:"form-control p-2 rounded-lg shadow",attrs:{type:"hit_id",id:"hit_id",name:"hit_id",placeholder:"User ID"},domProps:{value:t.vdata["hit_id"]},on:{input:function(e){e.target.composing||t.$set(t.vdata,"hit_id",e.target.value)}}})]),n("div",{staticClass:"text-center"},[n("button",{staticClass:"mt-2 btn btn-sm btn-warning p-h-2 rounded-lg font-semibold btn-block text-lg",attrs:{type:"submit"},on:{click:t.saveFace}},[n("i",{staticClass:"fa-solid fa-face-smile"}),t._v(" Simpan "+t._s(t.descriptors.length)+" Wajah ")])])])]),n("div",{staticClass:"col-10 shadow rounded-lg p-3 my-2"},[n("div",[n("video",{attrs:{id:"video",height:"680",width:"512",autoplay:"",muted:""},domProps:{muted:!0},on:{click:t.zoomCamera}})])])]),n("img",{staticStyle:{position:"absolute","z-index":"-10",top:"-10000px",width:"512px",height:"512px"},attrs:{src:"",id:"myimage",alt:""}}),n("button",{staticClass:"btn btn-sm btn-style2 text-white ",staticStyle:{position:"fixed",bottom:"20px",right:"20px"},attrs:{type:"button"},on:{click:t.startScan}},[n("img",{staticClass:"d-inline mr-2",staticStyle:{height:"30px"},attrs:{src:a("32bd"),alt:""}}),t._v(" Take Picture "),n("span",{staticClass:"ml-2 typcn typcn-camera text-2xl"})])])},r=[],i=a("53ca"),o=(a("277d"),a("6b75"));function c(t){if(Array.isArray(t))return Object(o["a"])(t)}a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("a630");function s(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}var u=a("06c5");function d(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(t){return c(t)||s(t)||Object(u["a"])(t)||d()}var p=a("1da1"),f=(a("96cf"),a("b0c0"),a("2b3d"),a("1276"),a("ac1f"),a("c19f"),a("ace4"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("d81d"),a("4160"),a("159b"),a("cfc3"),a("7db0"),a("4de4"),a("07ac"),a("e25e"),a("4795"),a("45fc"),a("99af"),a("0d03"),a("75bf")),m=a("2f0b"),h=a("bc3a"),g=a.n(h),b=new m["a"]("ci","https://ebkm.my.id/"),v={data:function(){return{loop:!0,user:[],users:[],descriptor:[],descriptors:[],vdata:{},camera:"depan",loading:!0,lanjut:!1,showOutput:!1,simpanOutput:!1}},layout:"app",methods:{extractImage:function(){var t=document.getElementById("filenya"),e=t.files[0],a=new FileReader,n=document.getElementById("myimage");n.title=e.name,a.onload=function(t){n.src=t.target.result},a.readAsDataURL(e),this.startScan(n,!1)},startVideo:function(){var t=this,e=document.getElementById("video");navigator.mediaDevices.getUserMedia({video:{facingMode:t.$store.state.camera?"user":"environment",resizeMode:"true"}}).then((function(a){t.loading=!1,t.$forceUpdate(),e.srcObject=a,e.src=window.URL.createObjectURL(a),e.play()}))},dataURItoBlob:function(t){for(var e=atob(t.split(",")[1]),a=t.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(e.length),r=new Uint8Array(n),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return new Blob([n],{type:a})},startScan:function(t){var e=arguments,a=this;return Object(p["a"])(regeneratorRuntime.mark((function n(){var r,i,o,c,s,u,d,l,m;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return c=function(t,e){t.parentNode.insertBefore(e,t.nextSibling)},r=!(e.length>1&&void 0!==e[1])||e[1],b.alert("Extract Data Wajah","bg-blue-400"),i=a,r?(b.alert("video","bg-yellow-400"),o=document.getElementById("video"),t=o):(b.alert("Image","bg-yellow-400"),o=document.getElementById("myimage"),t=o),s=f["createCanvasFromMedia"](o),s.style.position="absolute;",c(document.getElementById("video"),s),u={width:o.width,height:o.height},b.alert("scanning ...","bg-green-400"),console.log(u),f["matchDimensions"](s,u),f["euclideanDistance"]([0,0],[0,20]),d=[1],n.next=16,Promise.all(d.map(function(){var e=Object(p["a"])(regeneratorRuntime.mark((function e(a){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log(a),!0,e.next=4,f["detectSingleFace"](t).withFaceLandmarks().withFaceDescriptor();case 4:if(l=e.sent,console.log(l),l){e.next=9;break}e.next=17;break;case 9:return i.extractFaceFromBox(t,l.detection.box),n=f["resizeResults"](l,u),s.getContext("2d").clearRect(0,0,s.width,s.height),f["draw"].drawDetections(s,n),document.querySelectorAll("canvas").forEach((function(t,e){e>0&&t.remove()})),console.log(3),r=[new Float32Array(l.descriptor)],e.abrupt("return",r);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 16:m=n.sent,i.tidakDikenali(m);case 18:case"end":return n.stop()}}),n)})))()},cekduplicate:function(t,e){var a=this;window.user_directory.find({},function(){var n=Object(p["a"])(regeneratorRuntime.mark((function n(r,i){var o,c,s,u,d;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!(i.length>0)){n.next=14;break}if(i=i.filter((function(t){if(t.facejson)return t})),!(i.length>0)){n.next=11;break}return n.next=5,Promise.all(i.map(function(){var t=Object(p["a"])(regeneratorRuntime.mark((function t(e){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.facejson){t.next=4;break}return a=[],e.facejson.forEach((function(t){a.push(new Float32Array(Object.values(t[0])))})),t.abrupt("return",new f["LabeledFaceDescriptors"](JSON.stringify({EMP_NO:e.EMP_NO,_id:e._id,FULL_NAME:e.FULL_NAME}),a));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 5:o=n.sent,c=parseInt(a.$store.state.akurasiWajah)/100,s=new f["FaceMatcher"](o,c),e&&(console.log("fullFaceDescription",e),u=s.findBestMatch(e.descriptor),console.log("results",u),"unknown"==u._label?t[0]&&a.tidakDikenali(t):(d=JSON.parse(u.label),console.log("user",u),console.log("user[0]",a.user),d.EMP_NO==a.user[0].EMP_NO?t[0]&&(b.alert("Wajah ini milik"+d.FULL_NAME+", tambahkan lagi?","bg-purple-400","top:80px;right:30px;"),a.lanjut=!0,a.simpanOutput=!0,a.descriptor=t,a.$forceUpdate()):(b.alert("Wajah ini mirip dengan ".concat(d.FULL_NAME),"bg-red-500","top:80px;right:30px;"),confirm("Wajah ini mirip dengan ".concat(d.FULL_NAME,", Yakin tambahkan di user baru?"))?a.tidakDikenali(t):(a.simpanOutput=!1,a.$forceUpdate())))),n.next=12;break;case 11:t[0]&&a.tidakDikenali(t);case 12:n.next=15;break;case 14:t[0]&&a.tidakDikenali(t);case 15:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}())},tidakDikenali:function(t){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=e,n.simpanOutput=!0,n.descriptor=t,t[0]?(n.descriptors.push(t[0]),b.alert("Total data Wajah : "+n.descriptors.length,"bg-dark","top:80px;right:30px;"),n.descriptors.length,n.$forceUpdate()):b.alert("Wajah tidak ditemukan coba lagi !");case 4:case"end":return a.stop()}}),a)})))()},extractFaceFromBox:function(t,e){var a=this;return Object(p["a"])(regeneratorRuntime.mark((function n(){var r,i,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=document.getElementById("outputImage"),a.showOutput=!0,a.$forceUpdate(),i=[new f["Rect"](e.x,e.y,e.width,e.height)],n.next=6,f["extractFaces"](t,i);case 6:o=n.sent,0==o.length?console.log("Face not found"):o.forEach((function(t){r.src=t.toDataURL()}));case 8:case"end":return n.stop()}}),n)})))()},saveFace:function(){var t=this;return Object(p["a"])(regeneratorRuntime.mark((function e(){var a,n,r,i,o,c,s,u,d,l,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(a=t,b.alert("Uploading Data Wajah","bg-blue-400"),b.loadingOn(),n=document.getElementById("video"),r=document.createElement("canvas"),r.width=n.videoWidth,r.height=n.videoHeight,i=r.getContext("2d"),i.drawImage(n,0,0,r.width,r.height),o=r.toDataURL("image/png"),c=atob(o.split(",")[1]),s=[],u=0;u<c.length;u++)s.push(c.charCodeAt(u));return d=new Blob([new Uint8Array(s)],{type:"image/png"}),l=new FormData,l.append("employee_id",t.vdata.hit_id),l.append("file",d),l.append("faces",JSON.stringify(t.descriptors)),window.employees.update({hit_id:a.$store.state.employee.hit_id},{$set:{faces:JSON.stringify(a.descriptors),source_data:"local"}},{multi:!0},(function(t,e){})),e.prev=19,e.next=22,g.a.post(t.$store.state.baseURL+"/api/hit/register-face",l);case 22:p=e.sent,console.log(p),a.$store.dispatch("update_employees"),setTimeout((function(){1==p.data&&t.$router.push("/login")}),1e3),e.next=31;break;case 28:e.prev=28,e.t0=e["catch"](19),t.$router.push("/main");case 31:b.loadingOff();case 32:case"end":return e.stop()}}),e,null,[[19,28]])})))()},simpanDataWajah:function(){var t=this;return Object(p["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t,e.abrupt("return",new Promise((function(t,e){b.loadingOn(),a.$forceUpdate(),window.user_directory.find({},function(){var e=Object(p["a"])(regeneratorRuntime.mark((function e(n,r){var i,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(r.length>0)){e.next=12;break}return i=function(t,e){return t.filter((function(t){return!e.some((function(e){return t.ID_UPDATE===e.ID_UPDATE}))}))},e.next=4,b.collection("zharp_t_empmst").select('select EMP_NO,ID_UPDATE from zharp_t_empmst where MANDT="820"');case 4:o=e.sent,c=l(i(r,o.data)),console.log("difference",c),c.forEach(function(){var t=Object(p["a"])(regeneratorRuntime.mark((function t(e){var n,r,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n="string"!=typeof e["facejson"]?JSON.stringify(e["facejson"]):"",r={},!e["facejson"]){t.next=13;break}return i=a.dataURItoBlob("".concat(e["facegambar"]),"".concat(e["EMP_NO"],".png")),o=new FormData,o.append("file",i),o.append("nama_file",e["EMP_NO"]),o.append("secret",b.scramble("hit")),t.next=10,g.a.post("https://ebkm.my.id//assets/upload.php",o,{timeout:1e4,headers:{"Content-Type":"multipart/form-data"}});case 10:return r=t.sent,t.next=13,b.collection("zharp_t_empmst").select("\n                                    update zharp_t_empmst set \n                                    facejson='".concat(n,"',\n                                    ID_UPDATE='").concat(e["ID_UPDATE"],"',\n                                    facegambar='").concat(r.data?"https://ebkm.my.id/assets/".concat(r.data):"","'\n                                    where EMP_NO='").concat(e["EMP_NO"],"' AND MANDT='820'\n                                "));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),b.alert("Berhasil upload data wajah pegawai!","bg-blue-400"),b.loadingOff(),a.$forceUpdate(),t();case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())})));case 2:case"end":return e.stop()}}),e)})))()},zoomCamera:function(){document.querySelector("#video").classList.toggle("scale2")},format:function(t){return this.$datefns.format(new Date(t),"YYYYMMDDHHmmss")}},mounted:function(){var t=this;this.$store.state.hit_id&&(this.vdata.hit_id=this.$store.state.hit_id),"object"==("undefined"===typeof cordova?"undefined":Object(i["a"])(cordova))?document.addEventListener("deviceready",(function(){console.log("faceapi",f),t.startVideo()})):t.startVideo()}},w=v,y=a("2877"),x=Object(y["a"])(w,n,r,!1,null,null,null);e["default"]=x.exports},"07ac":function(t,e,a){var n=a("23e7"),r=a("6f53").values;n({target:"Object",stat:!0},{values:function(t){return r(t)}})},"0d03":function(t,e,a){var n=a("6eeb"),r=Date.prototype,i="Invalid Date",o="toString",c=r[o],s=r.getTime;new Date(NaN)+""!=i&&n(r,o,(function(){var t=s.call(this);return t===t?c.call(this):i}))},"32bd":function(t,e,a){t.exports=a.p+"img/face-loading.e13af414.gif"},"45fc":function(t,e,a){"use strict";var n=a("23e7"),r=a("b727").some,i=a("a640"),o=i("some");n({target:"Array",proto:!0,forced:!o},{some:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})},"53ca":function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");function n(t){return n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}},"6f53":function(t,e,a){var n=a("83ab"),r=a("df75"),i=a("fc6a"),o=a("d1e7").f,c=function(t){return function(e){var a,c=i(e),s=r(c),u=s.length,d=0,l=[];while(u>d)a=s[d++],n&&!o.call(c,a)||l.push(t?[a,c[a]]:c[a]);return l}};t.exports={entries:c(!0),values:c(!1)}},c19f:function(t,e,a){"use strict";var n=a("23e7"),r=a("da84"),i=a("621a"),o=a("2626"),c="ArrayBuffer",s=i[c],u=r[c];n({global:!0,forced:u!==s},{ArrayBuffer:s}),o(c)},cfc3:function(t,e,a){var n=a("74e8");n("Float32",(function(t){return function(e,a,n){return t(this,e,a,n)}}))},d81d:function(t,e,a){"use strict";var n=a("23e7"),r=a("b727").map,i=a("1dde"),o=i("map");n({target:"Array",proto:!0,forced:!o},{map:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=page-register-wajah.b5c6cfae.js.map
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["page-absen-selfie"],{"0538":function(e,t,a){"use strict";var s=a("1c0b"),n=a("861d"),r=[].slice,i={},o=function(e,t,a){if(!(t in i)){for(var s=[],n=0;n<t;n++)s[n]="a["+n+"]";i[t]=Function("C,a","return new C("+s.join(",")+")")}return i[t](e,a)};e.exports=Function.bind||function(e){var t=s(this),a=r.call(arguments,1),i=function(){var s=a.concat(r.call(arguments));return this instanceof i?o(t,s.length,s):t.apply(e,s)};return n(t.prototype)&&(i.prototype=t.prototype),i}},"069e":function(e,t,a){"use strict";a("f2cf")},"07ac":function(e,t,a){var s=a("23e7"),n=a("6f53").values;s({target:"Object",stat:!0},{values:function(e){return n(e)}})},"0d03":function(e,t,a){var s=a("6eeb"),n=Date.prototype,r="Invalid Date",i="toString",o=n[i],c=n.getTime;new Date(NaN)+""!=r&&s(n,i,(function(){var e=c.call(this);return e===e?o.call(this):r}))},"6f53":function(e,t,a){var s=a("83ab"),n=a("df75"),r=a("fc6a"),i=a("d1e7").f,o=function(e){return function(t){var a,o=r(t),c=n(o),l=c.length,d=0,u=[];while(l>d)a=c[d++],s&&!i.call(o,a)||u.push(e?[a,o[a]]:o[a]);return u}};e.exports={entries:o(!0),values:o(!1)}},"7e12":function(e,t,a){var s=a("da84"),n=a("58a8").trim,r=a("5899"),i=s.parseFloat,o=1/i(r+"-0")!==-1/0;e.exports=o?function(e){var t=n(String(e)),a=i(t);return 0===a&&"-"==t.charAt(0)?-0:a}:i},acd8:function(e,t,a){var s=a("23e7"),n=a("7e12");s({global:!0,forced:parseFloat!=n},{parseFloat:n})},c0b6:function(e,t,a){var s=a("23e7"),n=a("0538");s({target:"Function",proto:!0},{bind:n})},cfc3:function(e,t,a){var s=a("74e8");s("Float32",(function(e){return function(t,a,s){return e(this,t,a,s)}}))},d81d:function(e,t,a){"use strict";var s=a("23e7"),n=a("b727").map,r=a("1dde"),i=r("map");s({target:"Array",proto:!0,forced:!i},{map:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},e1b7:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"py-4 px-2 shadow bg-blue-light text-white font-bold"},[a("p",{staticClass:"mt-1 font-semibold text-xs float-right mr-3"},[e._v(" Face Recognition ")]),a("div",{staticClass:"ml-2 cursor-pointer",on:{click:function(t){return e.$router.go(-1)}}},[a("svg",{staticClass:"d-inline mr-1",staticStyle:{fill:"white"},attrs:{width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"}},[a("path",{attrs:{d:"M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"}})])])]),a("div",{staticClass:"row"},[e.streamOn?a("div",{staticClass:"col-sm-12 text-center"},[a("video",{attrs:{id:"videoQRCODE",autoplay:"",muted:""},domProps:{muted:!0},on:{click:e.startScan}}),a("div",{staticClass:"text-center rounded-t-lg shadow background_gps p-3"},[a("div",{staticStyle:{height:"70px"}},[a("div",{staticClass:"row justify-content-center"},[a("div",{staticClass:"col-9"},[a("div",{staticClass:"text-center"},[a("button",{staticClass:"p-3 mt-2 btn btn-sm btn-warning rounded-lg font-semibold btn-block text-sm",attrs:{type:"submit"},on:{click:e.startScan}},[a("svg",{staticClass:"d-inline mr-2",staticStyle:{fill:"black"},attrs:{width:"17",height:"17",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[a("path",{attrs:{d:"M220.6 121.2L271.1 96 448 96v96H333.2c-21.9-15.1-48.5-24-77.2-24s-55.2 8.9-77.2 24H64V128H192c9.9 0 19.7-2.3 28.6-6.8zM0 128V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H271.1c-9.9 0-19.7 2.3-28.6 6.8L192 64H160V48c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16l0 16C28.7 64 0 92.7 0 128zM168 304a88 88 0 1 1 176 0 88 88 0 1 1 -176 0z"}})]),e._v(" Take Picture ")])])])]),a("p",{staticClass:"text-xs text-white font-semibold mt-2"},[e._v("Ekspresi terdeteksi: "+e._s(e.expressions))]),""==e.message?a("p",{staticClass:"text-xs p-3 font-semibold text-white"},[e._v(" Remove Mask and any other accessories before take a selfie ! ")]):e._e(),a("div",{staticClass:"text-xs p-3 font-semibold text-white"},[""!=e.message?a("p",[e._v(e._s(e.message))]):e._e()])]),a("br"),a("br"),a("br"),a("br"),a("br")]),a("canvas",{staticClass:"d-none",staticStyle:{overflow:"auto"},attrs:{id:"canvas"}})]):a("div",{staticClass:"col-sm-12",staticStyle:{height:"100vh"},on:{click:function(t){e.getStream("video"),e.streamOn=!0,e.$forceUpdate()}}},[e._m(0)])])])},n=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"d-flex justify-content-center align-items-center shadow-lg rounded-lg",staticStyle:{height:"90vh"}},[a("div",{staticStyle:{width:"100%"}},[a("p",{staticClass:"text-center text-xl font-semibold"},[e._v(" Klik disini untuk Start Camera! ")])])])}],r=a("1da1"),i=(a("96cf"),a("d3b7"),a("3ca3"),a("ddb0"),a("d81d"),a("4160"),a("159b"),a("cfc3"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("ace4"),a("07ac"),a("b0c0"),a("e25e"),a("0d03"),a("acd8"),a("4795"),a("2b3d"),a("c0b6"),a("bc3a"),a("2f0b")),o=a("75bf"),c=new i["a"]("ci"),l={data:function(){return{isIos:!1,countIos:0,streamOn:!1,expressions:null,listUsers:[],urutanEkspresi:[],message:"",listExpressions:[]}},methods:{startScan:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,s,n,i,l,d,u,h,p,g,f,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.message="",a=document.getElementById("videoQRCODE"),s=t,e.next=6,o["createCanvasFromMedia"](a);case 6:return n=e.sent,n.style.position="absolute;",i={width:n.width,height:n.height},console.log(i),o["euclideanDistance"]([0,0],[0,20]),o["matchDimensions"](n,i),l=null,e.next=15,o["detectAllFaces"](a).withFaceLandmarks().withFaceDescriptors().withFaceExpressions();case 15:return l=e.sent,console.log("fullFaceDescription",l),console.log("change",l[0].landmarks.getMouth()),d=l[0].landmarks.getMouth(),console.log("mulut",d),console.log(l),u=o["resizeResults"](l,i),console.log(n.width,n.height),n.getContext("2d").clearRect(0,0,n.width,n.height),o["draw"].drawDetections(n,u),o["draw"].drawFaceLandmarks(n,u),console.log(s.$store.state.employee),h=[{facejson:JSON.parse(s.$store.state.employee.faces)}],e.next=30,Promise.all(h.map(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("label",t),!t.facejson){e.next=5;break}return a=[],t.facejson.forEach((function(e){a.push(new Float32Array(Object.values(e[0])))})),e.abrupt("return",new o["LabeledFaceDescriptors"](JSON.stringify({EMP_NO:s.$store.state.employee_id,FULL_NAME:s.$store.state.employee.name,_id:s.$store.state.employee_id}),a));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 30:if(p=e.sent,g=parseInt(s.$store.state.akurasiWajah)/100,f=new o["FaceMatcher"](p,g),m=l.map((function(e){return f.findBestMatch(e.descriptor)})),!(m.length>0)){e.next=43;break}if("unknown"!=m[0]._label){e.next=38;break}return c.alert("Wajah bukan milik "+s.$store.state.employee.name,"bg-black"),e.abrupt("return",!1);case 38:s.getExpression(l[0].expressions),document.querySelectorAll("canvas").forEach((function(e,t){t>0&&e.remove()})),m.forEach(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log(t),r=JSON.parse(t.label),i=JSON.parse(t._distance),console.log(i),console.log(r),s.faceid=r,100-100*i>60?(c.alert("Wajah ditemukan!","bg-green-400"),s.loading=!1,s.cekExpressionAbsen(r,n)):c.alert("Persentase hanya ".concat(100-100*i),"bg-green-400");case 7:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),e.next=45;break;case 43:s.loading=!1,c.alert("Data tidak ada atau tidak ditemukan di gang ini!");case 45:e.next=51;break;case 47:e.prev=47,e.t0=e["catch"](0),console.log("error"),c.alert("Recognition wajah gagal");case 51:case"end":return e.stop()}}),e,null,[[0,47]])})))()},cekExpressionAbsen:function(e,t){var a=this;if(0==this.listExpressions.length&&(this.listExpressions[0]=this.expressions),0==this.listUsers.length?this.listUsers[0]=e.EMP_NO:this.listUsers[1]=e.EMP_NO,console.log("checkd isini=============="),console.log(this.listUsers),console.log(this.expressions),this.listUsers.length>0&&this.listExpressions.length>0){if(this.listUsers[0]!=e.EMP_NO)return this.listUsers[0]=null,void c.alert("Data Perbandingan user tidak sama!");this.listExpressions[0]!=this.expressions?a.prosesAbsen(t):(c.alert("Validasi ekspresi ".concat(e["FULL_NAME"],", \n Gunakan Ekspresi yang berbeda!!")),a.message="Validasi ekspresi ".concat(e["FULL_NAME"],", \n Ubah Ekspresi anda seperti senyum/buka mulut/dll"))}this.$forceUpdate()},prosesAbsen:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,s,n,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:window.checktimes.remove({},{multi:!0},(function(e,t){})),a=t,c.loadingOn(),s=document.getElementById("videoQRCODE"),n=document.createElement("canvas"),n.width=s.videoWidth,n.height=s.videoHeight,r=n.getContext("2d"),r.drawImage(s,0,0,n.width,n.height),i=n.toDataURL("image/png"),t.$store.state.checktimes.unshift({id_user:t.$store.state.hit_id,name:t.$store.state.employee.name,checktime:a.formatTgl(new Date,"YYYY-MM-DD HH:mm:ss"),dataURL:i,work_location:a.$store.state.employee.work_location_id,lat:a.$store.state.lat,lng:a.$store.state.lng,type_location:a.$store.state.location,source_data:"local"}),window.checktimes.insert(t.$store.state.checktimes,(function(e,t){})),c.alert("Absen Berhasil","bg-blue-400"),c.loadingOff(),t.$router.push("/absen/checktime");case 15:case"end":return e.stop()}}),e)})))()},getExpression:function(e){var t=this;e.neutral=Math.round(Math.abs(parseFloat(e.neutral)-1)),e.happy=Math.round(Math.abs(parseFloat(e.happy)-1)),e.sad=Math.round(Math.abs(parseFloat(e.sad)-1)),e.angry=Math.round(Math.abs(parseFloat(e.angry)-1)),e.fearful=Math.round(Math.abs(parseFloat(e.fearful)-1)),e.disgusted=Math.round(Math.abs(parseFloat(e.disgusted)-1)),e.surprised=Math.round(Math.abs(parseFloat(e.surprised)-1)),0==e.neutral?t.expressions="neutral":0==e.happy?t.expressions="happy":0==e.sad?t.expressions="sad":0==e.angry?t.expressions="angry":0==e.fearful?t.expressions="fearful":0==e.disgusted?t.expressions="disgusted":0==e.surprised&&(t.expressions="surprised")},getImage:function(){var e=this,t=document.getElementById("videoQRCODE"),a=document.getElementById("canvas");a.width=t.videoWidth,a.height=t.videoHeight,a.getContext("2d").drawImage(t,0,0,t.videoWidth,t.videoHeight),a.toBlob((function(t){var a=new File([t],"photo.jpg",{type:"image/jpeg"});e.prosesAbsen(a)}),"image/jpeg")},getStream:function(e){var t=this;setTimeout((function(){var e=document.getElementById("videoQRCODE");console.log("video",e),navigator.mediaDevices.getUserMedia({video:{facingMode:t.$store.state.camera?"user":"environment",resizeMode:"true"}}).then((function(a){t.loading=!1,t.$forceUpdate(),e.srcObject=a,e.src=window.URL.createObjectURL(a),e.play()}))}),2e3)},getUserMedia:function(e){if(navigator.mediaDevices)return navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise((function(a,s){t.bind(navigator)(e,a,s)})):void 0},formatTgl:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD";return this.$datefns.format(new Date(e),t)}},mounted:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e;case 1:case"end":return t.stop()}}),t)})))()}},d=l,u=(a("069e"),a("2877")),h=Object(u["a"])(d,s,n,!1,null,"6a8aae12",null);t["default"]=h.exports},f2cf:function(e,t,a){}}]);
//# sourceMappingURL=page-absen-selfie.1c7a8e3d.js.map